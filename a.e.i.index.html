<!DOCTYPE html>
<html lang="es" data-xpan>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="color-scheme" content="light dark"/>
  <title>a.e.i.index</title>

  <style>
    :root{
      --bg:#0C0D0F; --fg:#E0E3E6; --fg-dim:#AEB4BA;
      --accent-aqua:#1FE4FF; --accent-radar:#6BFF6B;
      --line:#2A2E31; --grid:#0F1216;
      --header-h:64px; --g:clamp(10px,2.2vw,24px); --pad:clamp(12px,3vw,32px);
      --z-lines:0; --z-hud:1; --z-titles:2; --z-header:3;
    }
    @media (prefers-color-scheme:light){
      :root{ --bg:#F6F8FA; --fg:#0E1113; --fg-dim:#4A5158; --line:#D9DEE2; --grid:#EDEFF2; }
    }
    *{ box-sizing:border-box; } html,body{ height:100%; margin:0; } a{ color:inherit; text-decoration:none; }
    body{ background:var(--bg); color:var(--fg); font-family:"Times New Roman",serif; overflow:hidden; cursor:crosshair; }
    .hud{ position:fixed; inset:0; z-index:var(--z-hud); pointer-events:none;
      background:
        linear-gradient(transparent 49%, var(--grid) 50%, transparent 51%) 0 0/100% 36px,
        linear-gradient(90deg, transparent 49%, var(--grid) 50%, transparent 51%) 0 0/36px 100%;
      opacity:.22;
    }
    .hud::after{ content:""; position:absolute; inset:-20%; background:conic-gradient(from 0deg, rgba(31,228,255,.10), rgba(31,228,255,0) 35%); animation:sweep 6s linear infinite; opacity:.18; }
    @keyframes sweep{ to{ transform:rotate(360deg);} }
    header{ position:fixed; top:0; left:0; right:0; height:var(--header-h); display:flex; align-items:center; padding-left:var(--pad);
      border-bottom:1px solid var(--line); background:linear-gradient(to bottom, rgba(12,13,15,.85), rgba(12,13,15,.30) 60%, transparent); backdrop-filter:blur(4px); z-index:var(--z-header);
    }
    header a{ display:inline-flex; align-items:center; } header img{ width:46px; height:auto; display:block; filter:invert(1) contrast(1.1); }
    svg.lines{ position:fixed; inset:0; z-index:var(--z-lines); pointer-events:none; width:100vw; height:100vh; }
    svg.lines line{ vector-effect:non-scaling-stroke; stroke-width:.75; opacity:.35; transition:opacity .25s ease; }
    .floating-title{ position:absolute; z-index:var(--z-titles); font-size:clamp(.78rem,1.2vw,1rem); line-height:1; text-transform:lowercase; white-space:nowrap; pointer-events:auto;
      padding:4px 6px; background:rgba(12,13,15,.35); border:1px solid var(--line); border-radius:2px; backdrop-filter:blur(2px); transform:translate3d(0,0,0); will-change:transform;
      transition:color .25s, border-color .25s, background .25s, opacity .25s; user-select:none;
    }
    .floating-title:hover{ color:var(--fg); background:rgba(31,228,255,.10); border-color:rgba(31,228,255,.45); }
    .floating-title[data-group="A"]{ color:var(--accent-radar); } .floating-title[data-group="B"]{ color:var(--accent-aqua); }
    .paused .floating-title{ opacity:.85; }
    @media (prefers-reduced-motion:reduce){ .floating-title{ transition:none; } .hud::after{ animation:none; display:none; } }
    @supports (padding:max(0px)){ header{ padding-left:max(var(--pad), env(safe-area-inset-left)); padding-right:max(var(--pad), env(safe-area-inset-right)); } }
  </style>
</head>
<body>
  <header aria-label="xpan">
    <a href="https://xpan.earth"><img src="./xpan.svg" alt="xpan" /></a>
  </header>

  <div class="hud" aria-hidden="true"></div>
  <svg class="lines" id="dynamic-lines" role="presentation"></svg>

  <script>
    // carpeta contenedora para todos los a.e.i
    const BASE_DIR = "./a.e.i./";

    const titles = [
      "a.e.i.1",
      "a.e.i_msh_7+2[31.06.22]",
      "a.e.i.tp.bibliografia",
      "a.e.i.arcangel.png",
      "a.e.i_msh_ta morte est plus grande que toi",
      "a.e.i_msh_matdumat.jun.23",
      "a.e.i_xpan_ep.t paris 15.01.25",
      "a.e.i_xpan.fps_select.21.apr_29.apr",
      "a.e.i_msh_firekillsfireheals 19.feb.23",
      "a.e.i_msh_redimensionamiento_13.dic.24",
      "a.e.i_msh_vvv9 may.23",
      "a.e.i_xpan_apr 23 w.x",
      "a.e.i_xpan_atlas.1.ep1",
      "a.e.i_xpan_ep.1 select 24.feb.25",
      "a.e.i_xpan_mdtc.5_gata<>xpan.p2",
      "a.e.i_xpan_mdtc.5_gata<>xpan.p3",
      "a.e.i_xpan_newSTAR.mdl.1 2--2-2--3",
      "a.e.i_xpan_resolución gráfica aug-sep.24",
      "a.e.i_xpan_resolución gráfica feb.25",
      "a.e.i_xpan_studio.25",
      "a.e.i_msh_11.may.25 [yes no more]",
      "a.e.i_xpan.fps_select.sem.12.may.25",
      "a.e.i_msh_gwm_[gesturewithoutmotion]_lineadefuga",
      "a.e.i_msh_e",
      "a.e.i_xpan.fps_select.sem.19.may.25",
      "a.e.i_xpan.fps_select.sem.02.jun.25",
      "a.e.i_xpan.fps_select.sem.16.jun.25",
      "a.e.i_xpan.fps_select.sem.02.jul.25",
      "a.e.i_xpan_atlas.1 media select",
      "a.e.i_xpan.fps_select.sem.14.jul.25",
      "a.e.i_msh_circa_23_24_25.1",
      "a.e.i_xpan.fps_select.sem.04.ago.25",
      "a.e.i_xpan.fps_select.sem.18.ago.25",
      "a.e.i_msh.17.jul-19.ago.25[39^]",
      "a.e.i_xpan_poros.1",
      "a.e.i_msh.01-07.jan.26 time_space _and_connection",
      "a.e.i_xpan_screen.rec.ep.1",
      "a.e.i_msh_ops_14-20.ene.2026.mex"
    ];

    const container = document.body;
    const lineCanvas = document.getElementById('dynamic-lines');
    const nodesA = [], nodesB = [], allNodes = [];
    let paused = false;

    const bounds = () => ({
      w: innerWidth, h: innerHeight, lPad:12, rPad:12,
      tPad: (12 + (parseInt(getComputedStyle(document.documentElement).getPropertyValue('--header-h'))||64)),
      bPad:12
    });

    function makeNode(title){
      const el = document.createElement('a');
      el.className = 'floating-title';
      // apunta a /a.e.i/ + nombre codificado
      el.href = BASE_DIR + encodeURIComponent(title) + '.html';
      el.textContent = title;
      el.target = '_self';
      el.rel = 'noopener';
      el.setAttribute('role','link');
      el.setAttribute('aria-label', title);

      const isA = title.includes('_msh_') || title.includes('msh');
      el.dataset.group = isA ? 'A' : 'B';
      container.appendChild(el);

      const b = bounds();
      const node = { el, group:isA?'A':'B', x:0, y:0, vx:0, vy:0, w:0, h:0 };

      const leftZoneW = b.w*0.44, rightZoneW = b.w*0.44;
      node.x = isA ? (Math.random()*leftZoneW + b.lPad)
                   : (Math.random()*rightZoneW + (b.w - rightZoneW - b.rPad));
      node.y = Math.random()*(b.h - b.tPad - b.bPad) + b.tPad;

      node.vx = (Math.random()-0.5)*0.55;
      node.vy = (Math.random()-0.5)*0.55;

      el.addEventListener('mouseenter', ()=>setPaused(true));
      el.addEventListener('mouseleave', ()=>setPaused(false));
      el.addEventListener('touchstart', ()=>setPaused(true), {passive:true});
      el.addEventListener('touchend', ()=>setPaused(false), {passive:true});

      const rect = el.getBoundingClientRect();
      node.w = rect.width; node.h = rect.height;

      (isA?nodesA:nodesB).push(node);
      allNodes.push(node);
    }

    titles.forEach(makeNode);

    let currentLines = [];
    let nextLineUpdate = performance.now();
    let lineInterval = 500;
    const colorA = getComputedStyle(document.documentElement).getPropertyValue('--accent-radar').trim() || '#6BFF6B';
    const colorB = getComputedStyle(document.documentElement).getPropertyValue('--accent-aqua').trim() || '#1FE4FF';

    function chooseGroupLines(group){
      const list=[]; for(let i=0;i<group.length;i++){ for(let j=i+1;j<group.length;j++){ if(Math.random()<0.22) list.push([group[i],group[j]]); } }
      return list;
    }
    function regenerateLines(){ currentLines = [...chooseGroupLines(nodesA), ...chooseGroupLines(nodesB)]; }

    /* patch: sin reflow por cuadro; usar posiciones cacheadas */
    function redrawLines(){
      const frag = document.createDocumentFragment();
      for (const [a,b] of currentLines){
        const ax = a.x + a.w/2, ay = a.y + a.h/2;
        const bx = b.x + b.w/2, by = b.y + b.h/2;
        const l = document.createElementNS('http://www.w3.org/2000/svg','line');
        l.setAttribute('x1', ax); l.setAttribute('y1', ay);
        l.setAttribute('x2', bx); l.setAttribute('y2', by);
        l.setAttribute('stroke', (a.group==='A'&&b.group==='A')?colorA:colorB);
        frag.appendChild(l);
      }
      lineCanvas.replaceChildren(frag);
    }

    function tickNodes(dt){
      if(paused) return;
      const b=bounds();
      for(const n of allNodes){
        n.x += n.vx*dt*0.06; n.y += n.vy*dt*0.06;
        const minX=b.lPad, maxX=b.w-b.rPad-n.w, minY=b.tPad, maxY=b.h-b.bPad-n.h;
        if(n.x<minX){ n.x=minX; n.vx*=-1; }
        if(n.x>maxX){ n.x=maxX; n.vx*=-1; }
        if(n.y<minY){ n.y=minY; n.vy*=-1; }
        if(n.y>maxY){ n.y=maxY; n.vy*=-1; }
        n.el.style.transform = `translate3d(${n.x}px,${n.y}px,0)`;
      }
    }

    let last = performance.now();
    /* patch: cap de FPS en móvil para bajar calor */
    const MOBILE = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    const MIN_DELTA = 1000 / (MOBILE ? 30 : 60);

    /* patch: rAF estable con salto de frames en móvil */
    function frame(now){
      if(now - last < MIN_DELTA){ requestAnimationFrame(frame); return; }
      const dt = Math.min(64, now - last); last = now;

      tickNodes(dt);

      if(now>=nextLineUpdate){
        regenerateLines(); redrawLines();
        lineInterval = 420 + Math.random()*260;
        nextLineUpdate = now + lineInterval;
      }
      requestAnimationFrame(frame);
    }
    regenerateLines(); redrawLines(); requestAnimationFrame(frame);

    function setPaused(v){ paused=v; document.documentElement.classList.toggle('paused', v); }
    document.addEventListener('visibilitychange', ()=>setPaused(document.hidden));

    /* patch: actualizar tamaños solo en resize, sin medir por cuadro */
    addEventListener('resize', ()=>{
      const b=bounds(), leftZoneW=b.w*0.44, rightZoneW=b.w*0.44;
      for(const n of allNodes){
        n.w = n.el.offsetWidth; n.h = n.el.offsetHeight;
      }
      for(const n of nodesA){ n.x=Math.min(Math.max(n.x,b.lPad), b.lPad+leftZoneW); n.y=Math.min(Math.max(n.y,b.tPad), b.h-b.bPad-n.h); }
      for(const n of nodesB){ n.x=Math.max(Math.min(n.x,b.w-b.rPad), b.w-rightZoneW-b.rPad); n.y=Math.min(Math.max(n.y,b.tPad), b.h-b.bPad-n.h); }
      regenerateLines(); redrawLines();
    }, {passive:true});

    /* patch: pausa solo si el gesto empieza sobre un título */
    let pressT = null;
    addEventListener('pointerdown', (e)=>{ if(!e.target.closest('.floating-title')) return; pressT=setTimeout(()=>setPaused(true),120); }, {passive:true});
    addEventListener('pointerup',   (e)=>{ if(!e.target.closest('.floating-title')) return; clearTimeout(pressT); setPaused(false); }, {passive:true});
    /* patch: eliminar pausa por scroll (body overflow:hidden) */
    // addEventListener('scroll', ()=>setPaused(true), {passive:true});
  </script>
</body>
</html>
