<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>mdtc.pjt.mdl.1 — xpan</title>

<style>
  :root{
    --bg:#000000; --fg:#E0E3E6; --fg-dim:#AEB4BA;
    --line:#2A2E31; --line-weak:#1A1D20; --accent:#1860FF;
    --aei-stroke: rgba(224,227,230,.12); /* líneas AEI en dark */
    --maxw:1120px; --pad-x: clamp(16px,4vw,48px); --g:24px; --header-h:64px;
    --b1:1px solid var(--line);
  }
  @media (prefers-color-scheme:light){
    :root{
      --bg:#FFFFFF; --fg:#0E1113; --fg-dim:#4A5158;
      --line:#D9DEE2; --line-weak:#ECEFF2; --accent:#1860FF;
      --aei-stroke: rgba(14,17,19,.16); /* líneas AEI en light */
    }
  }

  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--fg);
    font-family:-apple-system,BlinkMacSystemFont,"Inter","Segoe UI",Roboto,Helvetica,Arial,sans-serif;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    overflow-x:hidden;
  }
  a{color:var(--accent); text-decoration:none; border-bottom:1px solid transparent; transition:border-color .15s linear}
  a:hover{border-color:var(--accent)}
  img,video{max-width:100%; height:auto; display:block}

  /* Header */
  header{
    position:fixed; top:12px; left:var(--pad-x); height:var(--header-h);
    display:flex; align-items:center; z-index:100;
  }
  header a{display:inline-flex; align-items:center}
  header img{
    width:48px; height:auto;
    mix-blend-mode:difference;        /* inversión óptica por fondo */
    filter: invert(1) saturate(100%); /* fallback en dark */
  }
  @media (prefers-color-scheme:light){
    header img{ filter:none; }        /* en light se ve negro sobre blanco */
  }

  /* Selector de idioma */
  .language-selector{
    position:fixed; top:12px; right:var(--pad-x); z-index:120;
    display:flex; gap:8px; align-items:center; text-transform:lowercase;
  }
  .language-selector button{
    -webkit-appearance:none; appearance:none;
    font:600 .85rem/1 system-ui, -apple-system, "Inter", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    color:var(--fg-dim); background:transparent; border:1px solid var(--line);
    padding:6px 10px; cursor:pointer; letter-spacing:.2px;
    transition:color .15s linear, border-color .15s linear, background-color .15s linear;
  }
  .language-selector button:hover{color:var(--fg)}
  .language-selector button.active{color:var(--fg); border-color:var(--accent); background:rgba(24,96,255,.06)}

  /* Layout */
  .container{max-width:var(--maxw); margin:calc(var(--header-h) + 40px) auto 48px; padding:0 var(--pad-x)}
  h1{font:700 1.35rem/1.25 system-ui; text-transform:lowercase; margin:0 0 6px}
  .meta{font:400 .9rem/1.5 system-ui; color:var(--fg-dim); margin:0 0 24px}
  .description{font:400 1rem/1.6 system-ui; max-width:720px}

  /* Galerías */
  .gallery{
    max-width:var(--maxw); margin:32px auto; padding:0 var(--pad-x);
    display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:var(--g);
  }
  .gallery img,.gallery video{
    border:var(--b1); border-radius:0; background:#0C0D0F;
    object-fit:cover; aspect-ratio:4/3; transition:opacity .15s linear, transform .15s linear;
  }
  .gallery img:hover,.gallery video:hover{opacity:.9; transform:scale(1.01)}

  /* Galería experimental (AEI) */
  .experimental-gallery{
    position:relative; width:100%; min-height:100vh; overflow:hidden; background:var(--bg); cursor:crosshair;
    border-top:var(--b1);
  }
  .experimental-gallery .background-star{
    position:absolute; top:50%; left:50%; width:100vmin; max-width:900px; transform:translate(-50%,-50%);
    opacity:.06; pointer-events:none;
  }
  .experimental-gallery .container{position:relative; width:100%; min-height:100vh}
  .image-block{
    width:160px; height:160px; position:absolute; opacity:.68;
    transition:opacity .2s linear; cursor:grab; user-select:none; will-change:transform; display:flex; justify-content:center; align-items:center;
    border:1px solid var(--line); background:transparent;
  }
  .image-block:active{cursor:grabbing}
  .image-block:hover{opacity:.9; z-index:5}
  /* Medios: permitir control en audio; click sobre imágenes y videos para lightbox */
  .image-block img,.image-block video,.image-block iframe{max-width:100%; max-height:100%; object-fit:contain; display:block; pointer-events:none; background:transparent}
  .image-block audio{max-width:100%; pointer-events:auto}

  #audio-notice{
    position:fixed; bottom:.5rem; right:.5rem; background:rgba(0,0,0,.5); color:#fff;
    padding:.3rem .6rem; font-size:.75rem; pointer-events:none; opacity:.85; transition:opacity 1s ease; border:1px solid var(--line);
  }
  @media (prefers-color-scheme:light){
    #audio-notice{background:rgba(255,255,255,.7); color:#000}
  }
  svg.lines{position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none}
  svg.lines line{stroke:var(--aei-stroke); stroke-width:.5px}

  @media(max-width:600px){ .image-block{width:100px; height:100px} }
</style>

<script src="/assets/js/media-proxy.js" defer></script>
</head>
<body>
  <header><a href="https://xpan.earth" target="_blank" rel="noopener"><img src="xpan.svg" alt="xpan"/></a></header>

  <div class="language-selector" role="tablist" aria-label="selector de idioma">
    <button type="button" onclick="setLang('es')" class="active" aria-pressed="true" role="tab">es</button>
    <button type="button" onclick="setLang('en')" aria-pressed="false" role="tab">en</button>
    <button type="button" onclick="setLang('fr')" aria-pressed="false" role="tab">fr</button>
    <button type="button" onclick="setLang('jp')" aria-pressed="false" role="tab">jp</button>
  </div>

  <div class="container">
    <!-- Español -->
    <div class="lang lang-es">
      <h1>mdtc.pjt.mdl.1</h1>
      <div class="meta">junio 2022 — ciudad de méxico</div>
      <div class="description">
        primera activación de xpan y presentación de la mdl.1.<br><br>
        doce bocinas suspendidas en una retícula de cables de acero definieron un corredor central abierto y neutro.<br>
        la estructura funcionó como dispositivo sonoro y espacial, estableciendo la forma de operar de xpan: intervenir el espacio a través de sistemas que generan presencia, vínculos y continuidad.<br>
        este primer montaje dio origen a los desarrollos posteriores y al marco operativo de xpan.
      </div>
    </div>

    <!-- English -->
    <div class="lang lang-en" style="display:none;">
      <h1>mdtc.pjt.mdl.1</h1>
      <div class="meta">june 2022 — mexico city</div>
      <div class="description">
        first activation of xpan and presentation of mdl.1.<br><br>
        twelve speakers suspended in a steel cable grid defined an open and neutral central corridor.<br>
        the structure functioned as a sonic and spatial device, establishing xpan's operating mode: intervening in space through systems that generate presence, connections, and continuity.<br>
        this first installation gave rise to subsequent developments and xpan's operational framework.
      </div>
    </div>

    <!-- Français -->
    <div class="lang lang-fr" style="display:none;">
      <h1>mdtc.pjt.mdl.1</h1>
      <div class="meta">juin 2022 — mexico</div>
      <div class="description">
        première activation de xpan et présentation de la mdl.1.<br><br>
        douze haut-parleurs suspendus dans une grille de câbles en acier ont défini un couloir central ouvert et neutre.<br>
        la structure a fonctionné comme un dispositif sonore et spatial, établissant le mode opératoire de xpan : intervenir dans l'espace à travers des systèmes qui génèrent présence, liens et continuité.<br>
        cette première installation a donné naissance aux développements ultérieurs et au cadre opérationnel de xpan.
      </div>
    </div>

    <!-- 日本語 -->
    <div class="lang lang-jp" style="display:none;">
      <h1>mdtc.pjt.mdl.1</h1>
      <div class="meta">2022年6月 — メキシコシティ</div>
      <div class="description">
        xpanの初のアクティベーションおよびmdl.1の発表。<br><br>
        12個のスピーカーが鋼ケーブルのグリッドに吊るされ、開放的で中立的な中央通路を形成。<br>
        この構造は音響的かつ空間的デバイスとして機能し、xpanの運用形態を確立しました：存在感、つながり、連続性を生み出すシステムを通じて空間に介入。<br>
        この最初の設置が、その後の開発とxpanの運用枠組みの出発点となりました。
      </div>
    </div>
  </div>

  <!-- Galería Principal -->
  <div class="gallery">
    <img loading="lazy" decoding="async" src="https://d2w9rnfcy7mm78.cloudfront.net/38445895/original_588c05160e05cdbd5239607c1502e12c.jpg?1753837433" alt="">
    <img loading="lazy" decoding="async" src="https://d2w9rnfcy7mm78.cloudfront.net/38445898/original_8a69dfb94945dc2510b3115ad9a88606.png?1753837495" alt="">
    <img loading="lazy" decoding="async" src="https://d2w9rnfcy7mm78.cloudfront.net/38445912/original_086c3d9df86785f120614b590e0dea5a.png?1753837549" alt="">
    <img loading="lazy" decoding="async" src="https://d2w9rnfcy7mm78.cloudfront.net/38445950/original_dad9943a5e22ded6666a2cd3b5464dcf.jpg?1753837732" alt="">
    <video preload="metadata" autoplay loop muted playsinline>
      <source src="https://attachments.are.na/38445951/a5dc0570d6e3336e3847d3d57eb07733.mp4?1753837741" type="video/mp4">
    </video>
    <img loading="lazy" decoding="async" src="https://d2w9rnfcy7mm78.cloudfront.net/38445955/original_4fd954e27397d0ef0c57acef8343909a.png?1753837761" alt="">
    <img loading="lazy" decoding="async" src="https://d2w9rnfcy7mm78.cloudfront.net/38445958/original_978838e64db5b7ea2ef562d9c2d1f306.png?1753837770" alt="">
    <img loading="lazy" decoding="async" src="https://d2w9rnfcy7mm78.cloudfront.net/38445964/original_22fceb940aeede6e831c6f2328be4d1c.png?1753837786" alt="">
    <img loading="lazy" decoding="async" src="https://d2w9rnfcy7mm78.cloudfront.net/38445969/original_8980d8697b7f8923acd2812f042479b3.png?1753837808" alt="">
    <img loading="lazy" decoding="async" src="https://d2w9rnfcy7mm78.cloudfront.net/38445920/original_0935539f62451c7c0b421c342e967457.png?1753837570" alt="">
    <img loading="lazy" decoding="async" src="https://d2w9rnfcy7mm78.cloudfront.net/38445931/original_aa8495a986e814cde445b3f46c57cae3.png?1753837618" alt="">
    <img loading="lazy" decoding="async" src="https://d2w9rnfcy7mm78.cloudfront.net/38445944/original_9eb335036391b0d032ce1783cc8e7b20.jpg?1753837681" alt="">
  </div>

  <!-- Galería Secundaria -->
  <div class="gallery">
    <img loading="lazy" decoding="async" src="https://d2w9rnfcy7mm78.cloudfront.net/38445980/original_65362a79046d609f57efc51e40ae7618.jpg?1753837949" alt="">
    <img loading="lazy" decoding="async" src="https://d2w9rnfcy7mm78.cloudfront.net/38445981/original_07155691a288930145f7d6949efcf603.jpg?1753837949" alt="">
    <img loading="lazy" decoding="async" src="https://d2w9rnfcy7mm78.cloudfront.net/38445982/original_679c42b38a604ac68d4a5595a7513b5b.jpg?1753837949" alt="">
    <img loading="lazy" decoding="async" src="https://d2w9rnfcy7mm78.cloudfront.net/38445983/original_75fcd9801104c9e846cf9cf8160cec02.jpg?1753837949" alt="">
    <img loading="lazy" decoding="async" src="https://d2w9rnfcy7mm78.cloudfront.net/38445984/original_27f4680fba7c7df92491ca830d0b46b2.jpg?1753837949" alt="">
    <video preload="metadata" autoplay loop muted playsinline>
      <source src="https://attachments.are.na/38445986/006128c80f5b948d38d097fb64eef6d7.mp4?1753837950" type="video/mp4">
    </video>
    <video preload="metadata" autoplay loop muted playsinline>
      <source src="https://attachments.are.na/38445987/e8c08ed0ad05442972691169a6fd2bf9.mov?1753837951" type="video/quicktime">
      <source src="https://attachments.are.na/38445987/e8c08ed0ad05442972691169a6fd2bf9.mov?1753837951" type="video/mp4">
    </video>
  </div>

  <!-- Galería experimental (AEI) -->
  <section class="experimental-gallery">
    <object class="background-star" type="image/svg+xml" data="mdtc.4 estrella.svg"></object>
    <div class="container" id="experimental-container">
      <svg class="lines" id="dynamic-lines" aria-hidden="true"></svg>
    </div>
  </section>

  <!-- Lightbox pantalla completa, igual a arquitectura -->
  <style>
    #xpan-lightbox{position:fixed;inset:0;z-index:9999;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);backdrop-filter:blur(10px) saturate(120%);-webkit-backdrop-filter:blur(10px) saturate(120%);touch-action:none;overscroll-behavior:contain}
    #xpan-lightbox.open{display:flex}
    #xpan-lightbox .sheet{position:relative;max-width:100vw;max-height:100vh;overflow:hidden;transform:scale(.985);opacity:0;transition:transform .18s cubic-bezier(.2,.8,.2,1),opacity .18s ease}
    #xpan-lightbox.open .sheet{transform:scale(1);opacity:1}
    #xpan-lightbox img,#xpan-lightbox video{display:block;width:auto;height:auto;max-width:100vw;max-height:100vh;object-fit:contain;margin:0;background:transparent}
    html.lb-open,body.lb-open{overflow:hidden;touch-action:none}
  </style>
  <div id="xpan-lightbox" role="dialog" aria-modal="true" aria-label="visor de medios"><div class="sheet"></div></div>

<script>
  /* Idiomas */
  function setLang(lang){
    localStorage.setItem('lang', lang);
    document.querySelectorAll('.lang').forEach(el=>el.style.display=el.classList.contains(`lang-${lang}`)?'block':'none');
    document.querySelectorAll('.language-selector button').forEach(btn=>{
      const active = btn.textContent===lang;
      btn.classList.toggle('active',active);
      btn.setAttribute('aria-pressed', active ? 'true':'false');
    });
    document.documentElement.setAttribute('lang', lang);
  }
  setLang(localStorage.getItem('lang') || (navigator.language.slice(0,2) || 'es'));

  /* Lazy y decoding */
  document.querySelectorAll('img').forEach(img=>{ img.loading ||= 'lazy'; img.decoding ||= 'async'; });

  /* Tap-to-unmute: al activar uno, los demás se silencian */
  function wireMediaSound(){
    const videos=[...document.querySelectorAll('video')];
    const audios=[...document.querySelectorAll('audio')];
    function muteOthers(except){
      videos.concat(audios).forEach(m=>{ if(m!==except){ m.muted=true; } });
    }
    videos.forEach(v=>{
      v.addEventListener('click',e=>{
        e.stopPropagation(); v.muted=!v.muted; if(!v.paused) v.play().catch(()=>{});
        muteOthers(v);
        document.getElementById('audio-notice').style.opacity='0';
      });
    });
    audios.forEach(a=>{
      a.controls=true;
      a.addEventListener('play',()=>{ muteOthers(a); document.getElementById('audio-notice').style.opacity='0'; });
    });
    document.body.addEventListener('click',()=>{
      videos.forEach(v=>v.play().catch(()=>{}));
      document.getElementById('audio-notice').style.opacity='0';
    },{once:true});
  }
  wireMediaSound();

  /* ======= Galería experimental: líneas k-vecinos con adaptación de tono ======= */
  const expContainer=document.getElementById('experimental-container');
  const svgLines=document.getElementById('dynamic-lines');
  const blocks=[];
  const expMedia = [
    "https://attachments.are.na/38445990/9808dfd192f87c95bc4bdc3fe074d3fd.m4a?1753837960",
    "https://d2w9rnfcy7mm78.cloudfront.net/38445992/original_7350e61df1aeddda4efc231e3ed59b09.jpg?1753837963",
    "https://d2w9rnfcy7mm78.cloudfront.net/38445994/original_a40c41f6f948110b64ed1a55ceb2204f.jpg?1753837965",
    "https://d2w9rnfcy7mm78.cloudfront.net/38445995/original_68dca9b812fe705e5f81d25f8fb1f93b.jpg?1753837966",
    "https://d2w9rnfcy7mm78.cloudfront.net/38445996/original_8119c74265f31f2fb0ad225373e73e18.png?1753837967",
    "https://d2w9rnfcy7mm78.cloudfront.net/38445998/original_acb5b9238a12f4eb257338aa86bda0c9.jpg?1753837969",
    "https://d2w9rnfcy7mm78.cloudfront.net/38445999/original_05e430b5ab366e0b74e25cc5c39f1a9c.jpg?1753837970",
    "https://d2w9rnfcy7mm78.cloudfront.net/38446000/original_aff41416f43fdc715748e18486a17ced.jpg?1753837971",
    "https://d2w9rnfcy7mm78.cloudfront.net/38446002/original_7681aff4e30a507b9a55be71cde7fb92.jpg?1753837971",
    "https://d2w9rnfcy7mm78.cloudfront.net/38446003/original_4097f99753f3b5eae59339eedd86b708.jpg?1753837972",
    "https://d2w9rnfcy7mm78.cloudfront.net/38446004/original_7d5aa296d9ca064cfadaeaa8161694ce.jpg?1753837973",
    "https://d2w9rnfcy7mm78.cloudfront.net/38446005/original_7a21f4c7100617f30390a2dc965b1da7.jpg?1753837973",
    "https://d2w9rnfcy7mm78.cloudfront.net/38446008/original_464cfd661c9a35d4cdbf41b5a9a94c1e.jpg?1753837979",
    "https://attachments.are.na/38446010/c3e342fbbc34940aa5003251ebd60825.mp4?1753837981",
    "https://d2w9rnfcy7mm78.cloudfront.net/38446011/original_d1b94f044f00b921d5a15c9d06a2ee38.jpg?1753837986",
    "https://d2w9rnfcy7mm78.cloudfront.net/38446012/original_256565569da20222f34f65f1f88e31fe.png?1753837987",
    "https://attachments.are.na/38446013/e191fb2baf96f86a808cdb1f83db9709.mp4?1753837989",
    "https://attachments.are.na/38446014/8b575ea12467a03a1888246a8fde9bad.pdf?1753837993",
    "https://d2w9rnfcy7mm78.cloudfront.net/38446015/original_e5695d514014bc252b5fa4c4dceb94a7.jpg?1753837993",
    "https://attachments.are.na/38446016/0d3c222c5ac74411448417ef2dad1a63.mp4?1753837993",
    "https://d2w9rnfcy7mm78.cloudfront.net/38446017/original_7dba62249e3fbb7df1b03b222cf66779.jpg?1753837994",
    "https://d2w9rnfcy7mm78.cloudfront.net/38446019/original_c0e35d30c96006502b7ec2a1565e68fe.jpg?1753838011",
    "https://attachments.are.na/38446041/47beab4cc59795157036bbe633a81c18.mov?1753838118"
  ];

  // Crear bloques con soporte de tipos
  expMedia.forEach(url=>{
    const block=document.createElement('div'); block.className='image-block';
    let el;
    if(/\.(mp4)$/i.test(url)){ el=document.createElement('video'); el.preload='metadata'; el.loop=true; el.muted=true; el.autoplay=true; el.playsInline=true; el.src=url; }
    else if(/\.(mov)$/i.test(url)){ el=document.createElement('video'); el.preload='metadata'; el.loop=true; el.muted=true; el.autoplay=true; el.playsInline=true;
      const s1=document.createElement('source'); s1.src=url; s1.type='video/quicktime';
      const s2=document.createElement('source'); s2.src=url; s2.type='video/mp4';
      el.appendChild(s1); el.appendChild(s2);
    }
    else if(/\.m4a$/i.test(url)){ el=document.createElement('audio'); el.src=url; el.controls=true; }
    else if(/\.pdf$/i.test(url)){ el=document.createElement('iframe'); el.src=url; el.loading='lazy'; el.referrerPolicy='no-referrer'; }
    else{ el=document.createElement('img'); el.src=url; el.loading='lazy'; el.decoding='async'; }
    block.appendChild(el);

    block.x=Math.random()*(window.innerWidth-200);
    block.y=Math.random()*(window.innerHeight-260);
    block.style.transform=`translate3d(${block.x}px,${block.y}px,0)`;
    makeDraggable(block);
    expContainer.appendChild(block);
    blocks.push(block);
  });

  // Drag estable
  function makeDraggable(el){
    let isDragging=false,lastX=0,lastY=0;
    const move=(cx,cy)=>{
      const dx=cx-lastX, dy=cy-lastY;
      el.x+=dx; el.y+=dy;
      el.style.transform=`translate3d(${el.x}px,${el.y}px,0)`;
      lastX=cx; lastY=cy;
      scheduleRecalc();
    };
    el.addEventListener('mousedown',e=>{e.preventDefault(); isDragging=true; lastX=e.clientX; lastY=e.clientY;});
    window.addEventListener('mousemove',e=>{ if(isDragging) move(e.clientX,e.clientY); });
    window.addEventListener('mouseup',()=>{ isDragging=false; });
    el.addEventListener('touchstart',e=>{const t=e.touches[0]; isDragging=true; lastX=t.clientX; lastY=t.clientY;},{passive:true});
    el.addEventListener('touchmove',e=>{ if(!isDragging) return; e.preventDefault(); const t=e.touches[0]; move(t.clientX,t.clientY); },{passive:false});
    el.addEventListener('touchend',()=>{ isDragging=false; },{passive:true});
  }

  // Líneas: k-vecinos y actualización en rAF
  let recalcPending=false;
  function scheduleRecalc(){
    if(recalcPending) return;
    recalcPending=true;
    requestAnimationFrame(()=>{ drawStableLines(); recalcPending=false; });
  }
  function drawStableLines(){
    const rect=expContainer.getBoundingClientRect();
    const pts = blocks.map(b=>({ x:b.x + b.offsetWidth/2 - rect.left, y:b.y + b.offsetHeight/2 - rect.top }));
    const k = Math.min(3, Math.max(1, Math.floor(Math.sqrt(blocks.length)/2))); // 1–3 vecinos
    while(svgLines.firstChild) svgLines.removeChild(svgLines.firstChild);
    for(let i=0;i<pts.length;i++){
      const dists = pts.map((p,j)=>({j, d:(i===j)?Infinity:((p.x-pts[i].x)**2 + (p.y-pts[i].y)**2)})).sort((a,b)=>a.d-b.d);
      for(let n=0;n<k;n++){
        const j = dists[n].j;
        if(j>i){
          const line=document.createElementNS('http://www.w3.org/2000/svg','line');
          line.setAttribute('x1', pts[i].x); line.setAttribute('y1', pts[i].y);
          line.setAttribute('x2', pts[j].x); line.setAttribute('y2', pts[j].y);
          svgLines.appendChild(line);
        }
      }
    }
  }
  scheduleRecalc();
  window.addEventListener('resize', scheduleRecalc);

  /* Lightbox: igual a arquitectura. Click en img/video fuera de <a>. */
  (()=>{const e=document.getElementById("xpan-lightbox"),t=e.querySelector(".sheet");let n=[],i=-1,o=0,a=0;
    function collect(){ n=Array.from(document.querySelectorAll("img,video")).filter(r=>!r.closest("#xpan-lightbox")&&!r.closest("a")&&(r.currentSrc||r.src)); }
    function openAt(idx){
      if(idx<0||idx>=n.length) return;
      i=idx; t.innerHTML="";
      const srcEl=n[i], isVideo=srcEl.tagName.toLowerCase()==="video";
      const el=document.createElement(isVideo?"video":"img");
      if(isVideo){
        el.src=srcEl.currentSrc||srcEl.src; el.playsInline=true; el.controls=true; el.loop=!!srcEl.loop; el.muted=srcEl.muted??true; !document.hidden&&(el.autoplay=true);
        el.addEventListener("click",ev=>ev.stopPropagation(),{passive:true});
        el.addEventListener("dblclick",ev=>{ev.stopPropagation(); closeLb();});
      }else{
        el.src=srcEl.currentSrc||srcEl.src; srcEl.srcset&&(el.srcset=srcEl.srcset); srcEl.sizes&&(el.sizes=srcEl.sizes); el.alt=srcEl.alt||""; el.decoding="async"; el.loading="eager";
      }
      t.appendChild(el); e.classList.add("open"); document.documentElement.classList.add("lb-open"); document.body.classList.add("lb-open");
    }
    function closeLb(){ e.classList.remove("open"); t.innerHTML=""; document.documentElement.classList.remove("lb-open"); document.body.classList.remove("lb-open"); i=-1; }
    function clickMedia(ev){
      const target=ev.target; if(!target) return; if(target.closest("a")) return;
      if(target.tagName==="IMG"||target.tagName==="VIDEO"){ ev.preventDefault(); ev.stopPropagation(); collect(); const idx=n.indexOf(target); if(idx>-1) openAt(idx); }
    }
    document.body.addEventListener("click",clickMedia,{capture:true,passive:false});
    e.addEventListener("click",ev=>{ev.preventDefault();ev.stopPropagation();closeLb()},{passive:false});
    window.addEventListener("keydown",ev=>{ if(!e.classList.contains("open")) return; if(ev.key==="Escape") closeLb(); if((ev.key==="ArrowRight"||ev.key==="l")&&i<n.length-1) openAt(i+1); if((ev.key==="ArrowLeft"||ev.key==="h")&&i>0) openAt(i-1); });
    new MutationObserver(()=>collect()).observe(document.documentElement,{subtree:true,childList:true});
    collect();
  })();
</script>
</body>
</html>
