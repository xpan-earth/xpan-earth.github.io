<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>a.e.i_msh.17.jul-19.ago.25[39^] — a.e.i + visor líquido</title>

  <!-- preconnect medios -->
  <link rel="preconnect" href="https://d2w9rnfcy7mm78.cloudfront.net" crossorigin>
  <link rel="preconnect" href="https://attachments.are.na" crossorigin>

  <style>
    :root{
      --bg:#ffffff; --fg:#0a0a0a; --line:rgba(0,0,0,.10);
      --radius:14px; --ease:cubic-bezier(.22,.61,.36,1);
      --aei-block:140px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family:"Times New Roman",serif}
    a{color:inherit;text-decoration:none}
    img,video{display:block;max-width:100%;height:auto}
    body{overflow-x:hidden}

    header{position:fixed;top:1rem;left:1rem;z-index:40}
    header img{width:50px;height:auto;display:block}

    main{padding:72px 12px 12px;max-width:1440px;margin:0 auto}

    /* a.e.i base */
    .aei-embed{position:relative;width:100%;height:100vh;min-height:100svh;background:#fff;border:1px solid var(--line);border-radius:var(--radius);overflow:hidden}
    .aei-stage{position:relative;width:100%;height:100%;touch-action:none}
    .aei-lines{position:absolute;inset:0;width:100%;height:100%;pointer-events:none}
    .aei-block{width:var(--aei-block);height:var(--aei-block);position:absolute;opacity:.72;transition:opacity .25s var(--ease);cursor:grab;user-select:none;display:flex;justify-content:center;align-items:center;touch-action:none}
    .aei-block:active{cursor:grabbing}
    .aei-block:hover{opacity:.9;z-index:5}
    .aei-block img,.aei-block video{max-width:100%;max-height:100%;object-fit:contain;display:block;pointer-events:none;background:#fff}

    /* visor líquido */
    .liqToggle{position:fixed;right:1rem;bottom:1rem;z-index:50;border:1px solid var(--line);border-radius:999px;background:#fff;padding:.55rem 1rem;font-size:.9rem;cursor:pointer}
    .liqOverlay{position:fixed;inset:0;background:#fff;z-index:45;display:none}
    .liqOverlay.on{display:block}
    .liqUI{position:absolute;top:12px;right:12px;display:flex;gap:8px;z-index:2}
    .liqBtn{background:#fff;border:1px solid var(--line);border-radius:999px;padding:.4rem .7rem;font-size:.85rem;cursor:pointer}
    .liqHint{position:absolute;left:12px;top:12px;font-size:.85rem;opacity:.6;background:transparent;padding:.35rem .5rem}
    canvas.liqCanvas{position:absolute;inset:0;width:100%;height:100%;display:block}

    @media (prefers-reduced-motion: reduce){ .aei-block{transition:none} }
  </style>

  <!-- proxy opcional si existe en tu sitio -->
  <script src="/assets/js/media-proxy.js" defer></script>
</head>
<body>
  <header>
    <a href="/" aria-label="xpan">
      <img src="xpan.svg" alt="xpan" fetchpriority="high">
    </a>
  </header>

  <main>
    <section class="aei-embed" aria-label="a.e.i">
      <svg class="aei-lines" id="aeiLines"></svg>
      <div class="aei-stage" id="aeiStage" aria-label="escena a.e.i"></div>
    </section>
  </main>

  <button class="liqToggle" id="liqToggle" type="button" aria-expanded="false">modo líquido (L)</button>

  <!-- Overlay visor líquido -->
  <div class="liqOverlay" id="liqOverlay" aria-hidden="true">
    <div class="liqUI">
      <button class="liqBtn" id="assignBtn" title="clic en bloques a.e.i para asignar">asignar → tex1</button>
      <button class="liqBtn" id="cycleBtn" title="auto-ciclo de pares">autociclo: off</button>
      <button class="liqBtn" id="clearBtn" title="limpia selección y reinicia">limpiar</button>
      <button class="liqBtn" id="closeBtn" title="cerrar">cerrar</button>
    </div>
    <div class="liqHint">arrastra masas · rueda = tamaño · tecla [L] cierra</div>
    <!-- canvas se inyecta aquí -->
  </div>

  <!-- three.js y shaders del efecto -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script id="vs" type="x-shader/x-vertex">
    varying vec2 vUv; void main(){ vUv=uv; gl_Position=vec4(position,1.0); }
  </script>
  <script id="fs" type="x-shader/x-fragment">
    precision mediump float; varying vec2 vUv;
    uniform sampler2D uTex1, uTex2; uniform vec2 uC1, uS1, uC2, uS2; uniform vec2 uPx; uniform float uTime;
    float rectMask(vec2 uv, vec2 c, vec2 s, float feather){ vec2 p=(uv-c)/s+0.5; vec2 d=min(p,1.0-p); float inside=step(0.0, min(d.x,d.y)); float aa=smoothstep(0.0, feather, min(d.x,d.y)); return inside*aa; }
    float blurMask(vec2 uv, vec2 c, vec2 s, float r){ vec2 o=uPx*r; vec2 k[9]; k[0]=vec2(0,0); k[1]=vec2(1,0); k[2]=vec2(-1,0); k[3]=vec2(0,1); k[4]=vec2(0,-1); k[5]=vec2(1,1); k[6]=vec2(-1,1); k[7]=vec2(1,-1); k[8]=vec2(-1,-1); float w[9]; w[0]=1.0; w[1]=0.9; w[2]=0.9; w[3]=0.9; w[4]=0.9; w[5]=0.7; w[6]=0.7; w[7]=0.7; w[8]=0.7; float m=0.0, sum=0.0; for(int i=0;i<9;i++){ float mi=rectMask(uv+vec2(k[i].x*o.x,k[i].y*o.y),c,s,0.02); m+=mi*w[i]; sum+=w[i]; } return m/max(sum,1e-5); }
    vec2 imgUV(vec2 uv, vec2 c, vec2 s){ return (uv-c)/s+0.5; }
    float n2(vec2 p){ return fract(sin(dot(p,vec2(127.1,311.7)))*43758.5453); }
    float noise(vec2 p){ vec2 i=floor(p), f=fract(p); float a=n2(i), b=n2(i+vec2(1,0)), c=n2(i+vec2(0,1)), d=n2(i+vec2(1,1)); vec2 u=f*f*(3.0-2.0*f); return mix(mix(a,b,u.x), mix(c,d,u.x), u.y); }
    vec2 warp(vec2 p, float k){ float t=uTime*0.8; vec2 q=p*vec2(20.0,16.0)+vec2(t,-t*0.7); vec2 d=vec2(noise(q),noise(q+17.3))-0.5; return p + k*0.04*d; }
    void main(){ float R=16.0; float m1=blurMask(vUv,uC1,uS1,R); float m2=blurMask(vUv,uC2,uS2,R); float field=pow(m1+m2,0.7); float lo=0.30, hi=0.52; float mask=smoothstep(lo,hi,field); if(mask<=0.0) discard; float r=m2/max(m1+m2,1e-6); float mixBias=0.65; float f=mix(r,0.5,mixBias); float k=smoothstep(hi,hi+0.35,field); vec2 uv1=warp(imgUV(vUv,uC1,uS1),k); vec2 uv2=warp(imgUV(vUv,uC2,uS2),k);
      bool i1=(uv1.x>=0.0&&uv1.x<=1.0&&uv1.y>=0.0&&uv1.y<=1.0); bool i2=(uv2.x>=0.0&&uv2.x<=1.0&&uv2.y>=0.0&&uv2.y<=1.0);
      vec3 c1=i1?texture2D(uTex1,uv1).rgb:vec3(0.0); vec3 c2=i2?texture2D(uTex2,uv2).rgb:vec3(0.0);
      vec3 col=mix(c1,c2,f);
      vec2 taps[8]; taps[0]=vec2(1,0); taps[1]=vec2(-1,0); taps[2]=vec2(0,1); taps[3]=vec2(0,-1); taps[4]=vec2(1,1); taps[5]=vec2(-1,1); taps[6]=vec2(1,-1); taps[7]=vec2(-1,-1);
      float rad=6.0; vec3 acc=col; float wsum=1.0; for(int i=0;i<8;i++){ vec2 off=vUv + taps[i]*uPx*rad; float m1n=blurMask(off,uC1,uS1,R); float m2n=blurMask(off,uC2,uS2,R); float fn=m2n/max(m1n+m2n,1e-6); float kn=smoothstep(hi,hi+0.35,pow(m1n+m2n,0.7)); vec2 uv1n=warp(imgUV(off,uC1,uS1),kn); vec2 uv2n=warp(imgUV(off,uC2,uS2),kn); bool j1=(uv1n.x>=0.0&&uv1n.x<=1.0&&uv1n.y>=0.0&&uv1n.y<=1.0); bool j2=(uv2n.x>=0.0&&uv2n.x<=1.0&&uv2n.y>=0.0&&uv2n.y<=1.0); vec3 c1n=j1?texture2D(uTex1,uv1n).rgb:vec3(0.0); vec3 c2n=j2?texture2D(uTex2,uv2n).rgb:vec3(0.0); vec3 cn=mix(c1n,c2n,mix(fn,0.5,0.65)); float wn=smoothstep(lo,hi+0.35,pow(m1n+m2n,0.7)); acc+=cn*wn; wsum+=wn; }
      col=acc/wsum; float rim=smoothstep(hi-0.02,hi+0.00,field)-smoothstep(hi+0.00,hi+0.08,field); col+=rim*0.10; gl_FragColor=vec4(col,1.0);
    }
  </script>

  <script>
  // ——— utilidades mínimas ———
  const $$=(sel,ctx=document)=>Array.from(ctx.querySelectorAll(sel));
  const BLANK_POSTER='data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';

  function wireVideoEl(v,{autoplay=true}={}){
    v.muted=true; v.loop=true; v.autoplay=!!autoplay; v.playsInline=true; v.preload='none'; v.poster=BLANK_POSTER;
    v.setAttribute('muted',''); v.setAttribute('playsinline',''); v.setAttribute('webkit-playsinline','');
    if(autoplay) v.setAttribute('autoplay','');
  }

  // IO para carga diferida
  const ioLoad=new IntersectionObserver((entries,obs)=>{
    entries.forEach(en=>{
      if(!en.isIntersecting) return; const v=en.target;
      if(v.dataset.src && !v.src){ v.src=v.dataset.src; v.load(); }
      obs.unobserve(v);
    });
  },{rootMargin:'600px 0px', threshold:.08});

  function autoPlayOnVisible(video){
    function tryPlay(){ video.play().catch(()=>{}); }
    const vio=new IntersectionObserver((ents)=>{
      ents.forEach(en=>{ if(en.isIntersecting){ video.muted=true; video.setAttribute('muted',''); tryPlay(); } else { video.pause(); } });
    },{threshold:.12});
    vio.observe(video);
    const t0=Date.now(); (function tick(){ if(!video.paused || Date.now()-t0>4000) return; tryPlay(); setTimeout(tick,300); })();
    document.addEventListener('visibilitychange',()=>{ if(document.visibilityState==='visible') tryPlay(); });
  }

  // ——— a.e.i render ———
  function renderAEI(stage, linesSVG, urls){
    const blocks=[], MAX_AT_ONCE=Math.min(urls.length, 42);
    let idx=0; let currentPairs=[], nextLineTick=0;

    function addNext(){
      if(idx>=MAX_AT_ONCE) return;
      const url=urls[idx++], block=document.createElement('div');
      block.className='aei-block'; let el;
      if(/\.(mp4|mov)(\?|$)/i.test(url)){
        el=document.createElement('video'); wireVideoEl(el,{autoplay:true}); el.dataset.src=url; block.appendChild(el); stage.appendChild(block); ioLoad.observe(el); autoPlayOnVisible(el);
      }else{
        el=document.createElement('img'); el.loading='lazy'; el.decoding='async'; el.src=url; block.appendChild(el); stage.appendChild(block);
      }
      const rect=stage.getBoundingClientRect(); const bw=parseFloat(getComputedStyle(block).width), bh=parseFloat(getComputedStyle(block).height);
      block.x=Math.random()*Math.max(10,rect.width-bw); block.y=Math.random()*Math.max(10,rect.height-bh);
      block.vx=(Math.random()-.5)*0.10; block.vy=(Math.random()-.5)*0.10; updateBlockTransform(block); makeDraggable(block);
      // click → asigna al visor líquido si está activo
      block.addEventListener('click',()=>{ if(liqState.open){ assignFromURL(url); } });
      blocks.push(block); setTimeout(addNext,45);
    }
    addNext();

    function updateBlockTransform(b){ b.style.transform=`translate3d(${b.x}px,${b.y}px,0)`; }
    function clampToStage(b){ const rect=stage.getBoundingClientRect(); const bw=parseFloat(getComputedStyle(b).width), bh=parseFloat(getComputedStyle(b).height); b.x=Math.min(Math.max(0,b.x), Math.max(0,rect.width-bw)); b.y=Math.min(Math.max(0,b.y), Math.max(0,rect.height-bh)); }

    function makeDraggable(el){
      let isDragging=false,lastX=0,lastY=0;
      const move=(cx,cy)=>{ const dx=cx-lastX, dy=cy-lastY; el.x+=dx; el.y+=dy; clampToStage(el); updateBlockTransform(el); lastX=cx; lastY=cy; drawLines(); };
      el.addEventListener('mousedown',e=>{e.preventDefault();isDragging=true;lastX=e.clientX;lastY=e.clientY;});
      window.addEventListener('mousemove',e=>{if(isDragging) move(e.clientX,e.clientY);});
      window.addEventListener('mouseup',()=>{isDragging=false;});
      el.addEventListener('touchstart',e=>{const t=e.touches[0];isDragging=true;lastX=t.clientX;lastY=t.clientY;},{passive:true});
      el.addEventListener('touchmove',e=>{if(!isDragging) return; e.preventDefault(); const t=e.touches[0]; move(t.clientX,t.clientY);},{passive:false});
      el.addEventListener('touchend',()=>{isDragging=false;});
    }

    function generateLines(){ currentPairs=[]; for(let i=0;i<blocks.length;i++){ for(let j=i+1;j<blocks.length;j++){ if(Math.random()<0.08) currentPairs.push([blocks[i],blocks[j]]); } } }
    function centerOf(b){ const r=b.getBoundingClientRect(); return [b.x+r.width/2, b.y+r.height/2]; }
    function drawLines(){ linesSVG.innerHTML=''; for(const [a,b] of currentPairs){ const [x1,y1]=centerOf(a), [x2,y2]=centerOf(b); const line=document.createElementNS('http://www.w3.org/2000/svg','line'); line.setAttribute('x1',x1); line.setAttribute('y1',y1); line.setAttribute('x2',x2); line.setAttribute('y2',y2); line.setAttribute('stroke','#000'); line.setAttribute('stroke-width','.6'); line.setAttribute('opacity','.18'); linesSVG.appendChild(line); } }
    function step(){ const rect=stage.getBoundingClientRect(); for(const b of blocks){ b.x+=b.vx; b.y+=b.vy; const bw=parseFloat(getComputedStyle(b).width), bh=parseFloat(getComputedStyle(b).height); if(b.x<0 || b.x>rect.width-bw) b.vx*=-1; if(b.y<0 || b.y>rect.height-bh) b.vy*=-1; clampToStage(b); updateBlockTransform(b); } if(!nextLineTick || performance.now()>nextLineTick){ generateLines(); nextLineTick=performance.now()+(120+Math.random()*480); } drawLines(); requestAnimationFrame(step); }
    step();

    window.addEventListener('resize',()=>{ for(const b of blocks){ clampToStage(b); updateBlockTransform(b); } },{passive:true});
  }

  // ——— LIQUID VIEWER (GLSL) ———
  const liqState={ open:false, target:1, autocycle:false, cycleTimer:null };
  const liqOverlay=document.getElementById('liqOverlay');
  const liqToggle=document.getElementById('liqToggle');
  const assignBtn=document.getElementById('assignBtn');
  const cycleBtn=document.getElementById('cycleBtn');
  const clearBtn=document.getElementById('clearBtn');
  const closeBtn=document.getElementById('closeBtn');

  let renderer, scene, cam, uniforms, mat, quad, tex1, tex2, canvasEl;
  let dragBlob=null; // {c:Vector2, s:Vector2}

  function initLiq(){
    if(renderer) return; // ya inicializado
    canvasEl=document.createElement('canvas'); canvasEl.className='liqCanvas';
    liqOverlay.appendChild(canvasEl);
    renderer=new THREE.WebGLRenderer({antialias:true, canvas:canvasEl});
    renderer.setPixelRatio(Math.min(devicePixelRatio||1, 2));
    resizeLiq();
    scene=new THREE.Scene(); cam=new THREE.OrthographicCamera(-1,1,1,-1,0,1);

    const loader=new THREE.TextureLoader(); loader.setCrossOrigin('anonymous');
    tex1=loader.load('https://d2w9rnfcy7mm78.cloudfront.net/38902721/original_ee28d6648bcc4e31dc4bfa19398cea14.jpg?1755663300?bc=0');
    tex2=loader.load('https://d2w9rnfcy7mm78.cloudfront.net/38902720/original_98b962e1a712e76ed58f513bb3b49e4a.jpg?1755663299?bc=0');
    tex1.minFilter=tex1.magFilter=THREE.LinearFilter; tex2.minFilter=tex2.magFilter=THREE.LinearFilter;

    uniforms={
      uTex1:{value:tex1}, uTex2:{value:tex2},
      uC1:{value:new THREE.Vector2(0.38,0.5)}, uS1:{value:new THREE.Vector2(0.32,0.32)},
      uC2:{value:new THREE.Vector2(0.62,0.5)}, uS2:{value:new THREE.Vector2(0.32,0.32)},
      uPx:{value:new THREE.Vector2(1/renderer.domElement.width, 1/renderer.domElement.height)},
      uTime:{value:0}
    };

    mat=new THREE.ShaderMaterial({
      uniforms, vertexShader:document.getElementById('vs').textContent,
      fragmentShader:document.getElementById('fs').textContent, transparent:false,
      depthTest:false, depthWrite:false, blending:THREE.NoBlending
    });
    quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2), mat); scene.add(quad);

    // interacciones
    const ptToUV=(e)=> new THREE.Vector2(e.clientX/renderer.domElement.clientWidth, 1 - e.clientY/renderer.domElement.clientHeight);
    const blobs=[{c:uniforms.uC1.value,s:uniforms.uS1.value},{c:uniforms.uC2.value,s:uniforms.uS2.value}];
    function hit(uv){ for(const b of blobs){ const p=uv.clone().sub(b.c).divide(b.s).addScalar(0.5); if(p.x>=0&&p.x<=1&&p.y>=0&&p.y<=1) return b; } return null; }

    canvasEl.addEventListener('pointerdown',e=>{ const uv=ptToUV(e); dragBlob=hit(uv); });
    window.addEventListener('pointermove',e=>{ if(!liqState.open||!dragBlob) return; const uv=ptToUV(e); dragBlob.c.set(uv.x, uv.y); });
    window.addEventListener('pointerup',()=>dragBlob=null);
    window.addEventListener('pointercancel',()=>dragBlob=null);
    window.addEventListener('wheel',e=>{ if(!dragBlob||!liqState.open) return; const t=e.deltaY>0?0.96:1.04; dragBlob.s.multiplyScalar(t); });
  }

  function resizeLiq(){
    if(!renderer) return; const w=liqOverlay.clientWidth||innerWidth; const h=liqOverlay.clientHeight||innerHeight;
    renderer.setSize(w,h,false); renderer.setViewport(0,0,w,h); if(uniforms) uniforms.uPx.value.set(1/w,1/h);
  }
  window.addEventListener('resize', resizeLiq, {passive:true});

  function openLiq(){ initLiq(); liqState.open=true; liqOverlay.classList.add('on'); liqOverlay.setAttribute('aria-hidden','false'); liqToggle.setAttribute('aria-expanded','true');
    renderer.setAnimationLoop((t)=>{ uniforms.uTime.value=t*0.001; renderer.setClearColor(0xffffff,1); renderer.render(scene,cam); });
  }
  function closeLiq(){ liqState.open=false; liqOverlay.classList.remove('on'); liqOverlay.setAttribute('aria-hidden','true'); liqToggle.setAttribute('aria-expanded','false'); renderer.setAnimationLoop(null); }

  // — asignación desde bloques a.e.i —
  function assignFromURL(url){ if(!liqState.open) return; if(/\.(mp4|mov)(\?|$)/i.test(url)){ setVideoTexture(url, liqState.target); } else { setImageTexture(url, liqState.target); } toggleTarget(); }
  function toggleTarget(){ liqState.target = (liqState.target===1?2:1); assignBtn.textContent = `asignar → tex${liqState.target}`; }

  function setImageTexture(url, which){
    const loader=new THREE.TextureLoader(); loader.setCrossOrigin('anonymous');
    const tex=loader.load(url,()=>{ tex.minFilter=tex.magFilter=THREE.LinearFilter; (which===1?uniforms.uTex1:uniforms.uTex2).value=tex; });
  }
  function setVideoTexture(url, which){
    try{
      const v=document.createElement('video'); v.crossOrigin='anonymous'; v.src=url; v.loop=true; v.muted=true; v.playsInline=true; v.autoplay=true; v.preload='auto'; v.setAttribute('muted',''); v.setAttribute('playsinline',''); v.setAttribute('webkit-playsinline',''); v.play().catch(()=>{});
      const tex=new THREE.VideoTexture(v); tex.minFilter=THREE.LinearFilter; tex.magFilter=THREE.LinearFilter; tex.generateMipmaps=false; (which===1?uniforms.uTex1:uniforms.uTex2).value=tex;
    }catch(err){ console.warn('VideoTexture falló, usando imagen:', err); setImageTexture(url, which); }
  }

  // UI eventos
  liqToggle.addEventListener('click',()=>{ liqState.open?closeLiq():openLiq(); });
  document.addEventListener('keydown',e=>{ if(e.key==='l' || e.key==='L'){ e.preventDefault(); liqState.open?closeLiq():openLiq(); } });
  assignBtn.addEventListener('click', toggleTarget);
  clearBtn.addEventListener('click',()=>{ const loader=new THREE.TextureLoader(); loader.setCrossOrigin('anonymous'); setImageTexture(imgPool[0]||fallbackImg,1); setImageTexture(imgPool[1]||fallbackImg,2); });
  closeBtn.addEventListener('click', closeLiq);

  cycleBtn.addEventListener('click',()=>{ liqState.autocycle=!liqState.autocycle; cycleBtn.textContent=`autociclo: ${liqState.autocycle?'on':'off'}`; if(liqState.autocycle) startCycle(); else stopCycle(); });
  function startCycle(){ stopCycle(); let i=0; liqState.cycleTimer=setInterval(()=>{ const a=imgPool[i%imgPool.length]; const b=imgPool[(i+1)%imgPool.length]; setImageTexture(a,1); setImageTexture(b,2); i=(i+2)%imgPool.length; }, 5000); }
  function stopCycle(){ if(liqState.cycleTimer){ clearInterval(liqState.cycleTimer); liqState.cycleTimer=null; } }

  // ——— datos: URLs del a.e.i (mismas del archivo base) ———
  const aeiMedia = [
  "https://attachments.are.na/38902682/0ad113fe72346cb0e320d672fac7e009.mov?1755663007",
  "https://attachments.are.na/38902606/c4754f13a1d09f36500ded9f69338384.mov?1755662683",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902605/original_13fd98b1144bdcbe3eddebc0f4e6ab32.png?1755662677?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902604/original_9e6bc3d928adb1a03bc5bc44c90ed4da.jpg?1755662677?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902603/original_712f4ba2f726267ea9452d4828a3ae48.jpg?1755662677?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902602/original_63b897a35d098eabba0e996ff1cd8587.jpg?1755662677?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902601/original_1199fe90de5e389cf8c9d5fa3da5f560.png?1755662677?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902600/original_55eedd41df6caed7ddffdacece0066e3.jpg?1755662676?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902599/original_09eb1131c02c8b1a7bd576cfdd7aaf80.png?1755662677?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902598/original_b613d722e961515022a11cae6bacbce3.jpg?1755662676?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902597/original_c7617720bf1d067cd7d5e9588c007c27.jpg?1755662677?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902596/original_36436c20c77489969fe8177500a8e0f2.png?1755662676?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902595/original_ebbe40e6f8d5c9e3fba5d3d1e3cd14e1.jpg?1755662676?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902594/original_aa37e32e361f371cfea89d239fe6af6b.png?1755662676?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902593/original_7d72e45a109946fb50c21f85734a48ef.jpg?1755662676?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902592/original_965eeb42511fb679e3db4df5463a9f66.jpg?1755662676?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902591/original_e03b2f9b8483efa54a77c55e4ab89fcd.jpg?1755662676?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902590/original_781bc941fed21d7e55a5153bd31a3139.jpg?1755662675?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902589/original_2ff1b991f092214615ce1f96c22ced4c.jpg?1755662675?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902588/original_ac58a167437b1fd560f2382948667ecb.jpg?1755662675?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902587/original_c4fc7f7a4062bb6f6598a96bf53bae46.jpg?1755662675?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902586/original_a12a5a222e1898a8895c1fa34a0865a0.png?1755662674?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902585/original_5a80cb11de1e26b00014d98e6037846c.jpg?1755662673?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902584/original_e9799eb7deff4093be9caefab97ad4f9.jpg?1755662674?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902583/original_08970f0fa19147f6b8cf39d5a0d3efb9.jpg?1755662674?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902582/original_56502bf33b2e727c2c566914b00b1461.jpg?1755662674?bc=0",
  "https://attachments.are.na/38902730/352c729e3a82dd18a32ee27aa035266e.mov?1755663318",
  "https://attachments.are.na/38902728/9b0c11e118754aaa2ba7daffd77408e3.mov?1755663314",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902726/original_6289b10147df5716069e242da845de85.jpg?1755663300?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902725/original_52d57b757725a78819ebed125e935506.png?1755663300?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902724/original_9ed4f32f3e3490cab445f9174e131813.jpg?1755663300?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902723/original_b5720c32ba87b7d3fad27a81ccf0ffd6.jpg?1755663300?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902722/original_a01cdf7a731fe3e277537035257c6cc2.jpg?1755663300?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902721/original_ee28d6648bcc4e31dc4bfa19398cea14.jpg?1755663300?bc=0",
  "https://d2w9rnfcy7mm78.cloudfront.net/38902720/original_98b962e1a712e76ed58f513bb3b49e4a.jpg?1755663299?bc=0"
  ];

  // a.e.i init
  const stage=document.getElementById('aeiStage');
  const lines=document.getElementById('aeiLines');
  renderAEI(stage, lines, aeiMedia);

  // pool de imágenes para el visor
  const fallbackImg = 'https://d2w9rnfcy7mm78.cloudfront.net/38902721/original_ee28d6648bcc4e31dc4bfa19398cea14.jpg?1755663300?bc=0';
  const imgPool = aeiMedia.filter(u=>/\.(png|jpe?g|webp)(\?|$)/i.test(u));

  // toggle overlay
  function ensureOpen(){ if(!liqState.open) openLiq(); }
  // atajo teclado
  document.addEventListener('keydown',e=>{ if(e.key==='Escape' && liqState.open){ closeLiq(); } });

  // tamaño inicial renderer tras primer open
  const ro=new ResizeObserver(()=>resizeLiq()); ro.observe(document.body);

  </script>
</body>
</html>
