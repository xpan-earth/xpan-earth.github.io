<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>cronograma experimental</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      color: #fff;
      font-family: "Times New Roman", serif;
      overflow-x: hidden;
    }
    .metadata-bar {
      position: fixed;
      top: 0;
      left: 0;
      width: calc(100% - 40px);
      padding: 6px 12px;
      background: rgba(0, 0, 0, 0.75);
      color: rgb(255, 0, 0);
      font-size: 12px;
      font-family: monospace;
      z-index: 10;
      border-bottom: 1px solid rgb(255, 0, 0);
      pointer-events: none;
      white-space: nowrap;
      overflow-x: auto;
    }
    .toggle-button {
      position: fixed;
      top: 0;
      right: 0;
      padding: 6px 12px;
      font-size: 18px;
      font-family: monospace;
      color: rgb(255, 0, 0);
      background: rgba(0, 0, 0, 0.75);
      z-index: 11;
      cursor: pointer;
      user-select: none;
      border-left: 1px solid rgb(255, 0, 0);
      border-bottom: 1px solid rgb(255, 0, 0);
    }
    .timeline, .grid {
      display: none;
    }
    .timeline.active {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: scroll;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
    }
    .grid.active {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 2px;
      padding-top: 36px;
    }
    .item {
      flex: 0 0 auto;
      width: 100vw;
      scroll-snap-align: center;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      transform: scale(1);
      transition: transform 0.5s ease;
      mix-blend-mode: lighten;
    }
    .item img, .item video {
      max-width: 100%;
      max-height: 100vh;
      object-fit: contain;
      filter: contrast(1.2) brightness(1.1);
      cursor: pointer;
    }
    .item:hover {
      transform: scale(1.05);
      z-index: 2;
    }
    .fullscreen-view {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }
    .fullscreen-view img, .fullscreen-view video {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }
    svg#line {
      position: fixed;
      top: 30px;
      left: 0;
      width: 100%;
      height: 2px;
      z-index: 5;
    }
  </style>
</head>
<body>
  <div class="metadata-bar" id="metadata"></div>
  <div class="toggle-button" id="toggle">ð’…’ð’„†</div>
  <svg id="line"><line x1="0" y1="1" x2="100%" y2="1" stroke="rgb(255, 0, 0)" stroke-width="1" /></svg>
  <div class="timeline active" id="timeline"></div>
  <div class="grid" id="grid"></div>
  <div class="fullscreen-view" id="fullscreen" onclick="this.style.display='none'"></div>

  <script>
    async function loadTimeline() {
      const res = await fetch('timeline.index.json');
      let data = await res.json();

      for (let i = data.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [data[i], data[j]] = [data[j], data[i]];
      }

      const timeline = document.getElementById('timeline');
      const grid = document.getElementById('grid');
      const metadataBar = document.getElementById('metadata');
      const fullscreen = document.getElementById('fullscreen');

      const createItem = (item, index) => {
        const el = document.createElement('div');
        el.className = 'item';

        const media = (item.url.endsWith('.mp4') || item.url.includes('video'))
          ? document.createElement('video')
          : document.createElement('img');

        media.src = item.url;
        if (media.tagName === 'VIDEO') {
          media.autoplay = true;
          media.loop = true;
          media.muted = true;
          media.playsInline = true;
        }

        el.appendChild(media);
        const date = item.ts ? new Date(item.ts).toISOString().split('T')[0] : '';
        const desc = item.description || '';
        el.dataset.date = date;
        el.dataset.desc = desc;
        el.dataset.index = index;

        el.addEventListener('click', () => {
          fullscreen.innerHTML = '';
          const fsMedia = media.cloneNode(true);
          if (fsMedia.tagName === 'VIDEO') fsMedia.muted = false;
          fullscreen.appendChild(fsMedia);
          fullscreen.style.display = 'flex';
        });

        return el;
      };

      data.forEach((item, index) => {
        timeline.appendChild(createItem(item, index));
        grid.appendChild(createItem(item, index));
      });

      const updateMetadata = () => {
        const items = [...document.querySelector('.timeline.active')?.children || []];
        const center = window.innerWidth / 2;
        let closest = null;
        let minDist = Infinity;

        items.forEach(item => {
          const rect = item.getBoundingClientRect();
          const dist = Math.abs(rect.left + rect.width / 2 - center);
          if (dist < minDist) {
            minDist = dist;
            closest = item;
          }
        });

        if (closest) {
          const date = closest.dataset.date;
          const desc = closest.dataset.desc;
          metadataBar.textContent = `fecha: ${date}${desc ? ' â€” ' + desc : ''}`;
        }
      };

      document.getElementById('timeline').addEventListener('scroll', () => {
        requestAnimationFrame(updateMetadata);
      });

      updateMetadata();

      document.getElementById('toggle').addEventListener('click', () => {
        timeline.classList.toggle('active');
        grid.classList.toggle('active');
        updateMetadata();
      });
    }

    loadTimeline();
  </script>
</body>
</html>


